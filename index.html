<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced macOS Notes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/inter-ui/3.19.3/inter.min.css">
    <link rel="icon" href="resources/favicon.png" type="image/x-icon">
    <style>
        :root {
            --bg-color: #1f1f1f;
            --sidebar-bg: #2d2d2d;
            --border-color: #404040;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --selection-bg: #0d52bf;
            --selection-hover: #0a3d8f;
            --accent-color: #007AFF;
            --accent-hover: #0056b3;
            --transition-speed: 0.2s;
            --code-bg: #282c34;
            --heading-color: #61dafb;
            --quote-color: #98c379;
            --link-color: #61afef;
            --highlight-color: rgba(255, 203, 107, 0.2);
            --font-heading: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
            --font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
            --font-mono: 'SF Mono', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', monospace;
            --editor-padding: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-body);
        }

        body {
            background: #363636;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            transition: padding var(--transition-speed);
            font-feature-settings: "cv02", "cv03", "cv04", "cv11";
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .window {
            width: 100%;
            max-width: 1100px;
            height: 80vh;
            max-height: 800px;
            min-height: 500px;
            background: var(--bg-color);
            border-radius: 14px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all var(--transition-speed);
        }

        .titlebar {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
            user-select: none;
        }

        .traffic-lights {
            display: flex;
            gap: 8px;
        }

        .traffic-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.1);
            transition: opacity 0.15s;
        }

        .traffic-light:hover {
            opacity: 0.8;
        }

        .close { background: #ff5f57; }
        .minimize { background: #febc2e; }
        .expand { background: #28c940; }

        .window-title {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            letter-spacing: 0.3px;
        }

        .content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .sidebar-toggle {
            display: none;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .sidebar-toggle:hover {
            background: rgba(255,255,255,0.1);
        }

        .sidebar {
            width: 295px;
            border-right: 1px solid var(--border-color);
            padding: 16px;
            background: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-speed), width var(--transition-speed);
            overflow-y: auto;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .sidebar-title {
            color: var(--text-primary);
            font-size: 16px;
            font-family: var(--font-heading);
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .notes-count {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .search-bar {
            margin-bottom: 16px;
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 8px 12px 8px 32px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            background: rgba(255,255,255,0.15);
            border-color: var(--accent-color);
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 14px;
        }

        .notes-list {
            list-style: none;
            overflow-y: auto;
            flex: 1;
        }

        .note-item {
            padding: 12px;
            border-radius: 8px;
            color: var(--text-primary);
            margin-bottom: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 4px;
            transition: background 0.15s;
            user-select: none;
        }

        .note-item:hover {
            background: rgba(255,255,255,0.05);
        }

        .note-item-title {
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            letter-spacing: -0.01em;
        }

        .note-item-preview {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-height: 1.5em;
        }

        .note-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
        }

        .timestamp {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .sidebar-footer {
            margin-top: 16px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .new-note-btn {
            flex: 1;
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background 0.15s;
            letter-spacing: 0.3px;
            min-width: 100px;
        }

        .new-note-btn:hover {
            background: var(--accent-hover);
        }

        .export-import-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            width: 100%;
        }

        .export-all-btn, .import-btn {
            flex: 1;
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: background 0.15s;
        }

        .export-all-btn:hover, .import-btn:hover {
            background: rgba(255,255,255,0.15);
        }

        .main-editor {
            flex: 1;
            padding: var(--editor-padding);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: opacity var(--transition-speed);
        }

        .note-title {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 22px;
            font-weight: 600;
            font-family: var(--font-heading);
            margin-bottom: 12px;
            padding: 8px;
            width: 100%;
            transition: background 0.15s;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .note-content {
            flex: 1;
            background: none;
            border: none;
            resize: none;
            color: var(--text-primary);
            font-size: 16px;
            line-height: 1.7;
            padding: 8px;
            width: 100%;
            transition: background 0.15s;
            font-family: var(--font-mono);
            letter-spacing: -0.01em;
        }

        .note-content p {
            margin-bottom: 1.2em;
        }

        .note-title:focus,
        .note-content:focus {
            outline: none;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }

        /* Styling for richtext elements */
        .note-content h1, .note-content h2, .note-content h3,
        .note-content h4, .note-content h5, .note-content h6 {
            color: var(--heading-color);
            font-family: var(--font-heading);
            font-weight: 700;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            letter-spacing: -0.02em;
            line-height: 1.3;
        }

        .note-content h1 { font-size: 1.75em; }
        .note-content h2 { font-size: 1.5em; }
        .note-content h3 { font-size: 1.3em; }
        .note-content h4 { font-size: 1.1em; }

        .note-content blockquote {
            border-left: 3px solid var(--quote-color);
            padding-left: 16px;
            margin-left: 0;
            color: var(--quote-color);
            font-style: italic;
        }

        .note-content a {
            color: var(--link-color);
            text-decoration: none;
        }

        .note-content a:hover {
            text-decoration: underline;
        }

        .note-content code {
            font-family: var(--font-mono);
            background: var(--code-bg);
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .note-content pre {
            background: var(--code-bg);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1em 0;
        }

        .note-content pre code {
            background: transparent;
            padding: 0;
            border-radius: 0;
        }

        .note-content ul, .note-content ol {
            padding-left: 24px;
            margin: 1em 0;
        }

        .note-content li {
            margin-bottom: 0.5em;
        }

        .note-content img {
            max-width: 100%;
            border-radius: 8px;
        }

        .note-content hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 2em 0;
        }

        .note-content mark {
            background-color: var(--highlight-color);
            padding: 2px 0;
        }

        .note-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }

        .note-content th, .note-content td {
            border: 1px solid var(--border-color);
            padding: 8px 12px;
        }

        .note-content th {
            background: rgba(255,255,255,0.05);
        }

        .editor-placeholder {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: var(--text-secondary);
            text-align: center;
            opacity: 0.7;
        }

        .placeholder-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .editor-container {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 16px;
            border-top: 1px solid var(--border-color);
        }

        .actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 6px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .action-btn:hover {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }

        .info-text {
            color: var(--text-secondary);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .delete-note-btn {
            color: #ff5f57;
        }

        .delete-note-btn:hover {
            background: rgba(255, 95, 87, 0.1);
        }

        /* File input for import */
        .import-file-input {
            display: none;
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 16px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 1000;
            max-width: 300px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.error {
            background: #ff5f57;
        }

        .notification i {
            font-size: 20px;
        }

        .notification-message {
            flex: 1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 0;
                align-items: stretch;
            }

            .window {
                border-radius: 0;
                height: 100vh;
                max-height: none;
            }

            .sidebar {
                position: absolute;
                height: calc(100% - 43px);
                top: 43px;
                z-index: 10;
                transform: translateX(-100%);
                width: 85%;
                max-width: 300px;
                box-shadow: 5px 0 15px rgba(0,0,0,0.3);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .sidebar-toggle {
                display: block;
            }

            .main-editor {
                width: 100%;
                padding: 16px;
                --editor-padding: 16px;
            }

            .titlebar {
                padding: 8px 12px;
            }

            .window-title {
                font-size: 12px;
            }

            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 5;
            }

            .overlay.active {
                display: block;
            }

            .toolbar {
                padding: 6px 12px;
            }

            .sidebar-footer {
                flex-direction: column;
            }

            .export-import-container {
                flex-direction: row;
            }
        }

        /* Dark mode animation */
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .theme-switch {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: all 0.15s;
        }

        .theme-switch:hover {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }

        body.light-mode {
            background: #f0f0f0;
        }

        body.light-mode .window {
            background: #ffffff;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        body.light-mode :root {
            --bg-color: #ffffff;
            --sidebar-bg: #f5f5f5;
            --border-color: #e0e0e0;
            --text-primary: #333333;
            --text-secondary: #666666;
            --selection-bg: #007AFF;
            --selection-hover: #0056b3;
            --code-bg: #f5f7fa;
            --heading-color: #0366d6;
            --quote-color: #5a9d54;
            --link-color: #0366d6;
            --highlight-color: rgba(255, 211, 66, 0.25);
        }

        body.light-mode .note-title::placeholder,
        body.light-mode .note-content::placeholder,
        body.light-mode .search-input::placeholder {
            color: #999;
        }

        body.light-mode .note-content code {
            color: #333;
        }

        /* Animation for empty state */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .placeholder-icon {
            animation: float 3s ease-in-out infinite;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }

        body.light-mode ::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
        }

        body.light-mode ::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.3);
        }

        /* Text highlighting */
        ::selection {
            background: var(--accent-color);
            color: white;
        }

        /* Tag styling */
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 4px;
            margin-bottom: 4px;
            color: white;
        }

        /* Auto syntax highlighting */
        .syntax-highlight {
            color: var(--accent-color);
        }

        .syntax-string {
            color: #98c379;
        }

        .syntax-number {
            color: #d19a66;
        }

        .syntax-keyword {
            color: #c678dd;
        }

        .syntax-function {
            color: #61afef;
        }

        .syntax-comment {
            color: #7f848e;
            font-style: italic;
        }

        /* Heading shake animation */
        @keyframes subtle-shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(0.5deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-0.5deg); }
            100% { transform: rotate(0deg); }
        }

        .heading-animation {
            animation: subtle-shake 5s infinite;
            animation-timing-function: ease-in-out;
            transform-origin: center;
            display: inline-block;
        }

        /* Font animations */
        @keyframes font-breathe {
            0% { font-weight: 400; }
            50% { font-weight: 500; }
            100% { font-weight: 400; }
        }

        /* Statistics bar */
        .statistics {
            display: flex;
            gap: 16px;
            color: var(--text-secondary);
            font-size: 12px;
        }

        .statistic {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .statistic i {
            font-size: 14px;
        }

        /* Reading time indicator */
        .reading-time {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Highlighted match in search results */
        .highlight-match {
            background-color: rgba(255, 203, 107, 0.4);
            border-radius: 2px;
            padding: 0 2px;
        }

        /* Search help tooltip */
        .search-help {
            position: relative;
            margin-left: 8px;
        }

        .search-help-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
            border-radius: 50%;
            transition: color 0.2s;
        }

        .search-help-btn:hover {
            color: var(--text-primary);
        }

        .search-help-tooltip {
            position: absolute;
            right: 0;
            top: calc(100% + 8px);
            width: 250px;
            background: var(--sidebar-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 100;
            color: var(--text-primary);
            font-size: 13px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(10px);
            transition: opacity 0.2s, transform 0.2s;
        }

        .search-help:hover .search-help-tooltip {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .search-help-tooltip h4 {
            margin-bottom: 8px;
            color: var(--accent-color);
        }

        .search-help-tooltip ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 10px;
        }

        .search-help-tooltip li {
            margin-bottom: 6px;
        }

        .search-help-tooltip code {
            background: rgba(0,0,0,0.2);
            padding: 2px 5px;
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: 12px;
        }

        .search-help-tooltip p {
            font-style: italic;
            font-size: 12px;
        }

        /* Update the search input placeholder to hint at the new capabilities */
        .search-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="window">
        <div class="titlebar">
            <div class="traffic-lights">
                <div class="traffic-light close"></div>
                <div class="traffic-light minimize"></div>
                <div class="traffic-light expand"></div>
            </div>
            <div class="window-title">Notes</div>
            <button class="sidebar-toggle"><i class="fas fa-bars"></i></button>
        </div>
        <div class="content">
            <div class="overlay"></div>
            <div class="sidebar">
                <div class="sidebar-header">
                    <h2 class="sidebar-title">Notes</h2>
                    <span class="notes-count">0 notes</span>
                </div>
                <div class="search-bar">
                    <span class="search-icon"><i class="fas fa-search"></i></span>
                    <input type="text" class="search-input" placeholder="Search notes... (try 'quotes' or +required)">
                    <div class="search-help">
                        <button class="search-help-btn" title="Search Help">
                            <i class="fas fa-question-circle"></i>
                        </button>
                        <div class="search-help-tooltip">
                            <h4>Advanced Search</h4>
                            <ul>
                                <li><code>"exact phrase"</code> - Search for exact phrase</li>
                                <li><code>term1 term2</code> - Match either term</li>
                            </ul>
                            <p>Example: <code>"action items" meeting</code></p>
                        </div>
                    </div>
                </div>
                <ul class="notes-list"></ul>
                <div class="sidebar-footer">
                    <button class="new-note-btn">
                        <i class="fas fa-plus"></i>
                        <span>New Note</span>
                    </button>
                    <div class="export-import-container">
                        <button class="export-all-btn">
                            <i class="fas fa-file-export"></i>
                            <span>Export All</span>
                        </button>
                        <button class="import-btn">
                            <i class="fas fa-file-import"></i>
                            <span>Import</span>
                        </button>
                        <input type="file" class="import-file-input" accept=".json">
                    </div>
                </div>
            </div>
            <div class="main-editor">
                <div class="editor-placeholder">
                    <div class="placeholder-icon"><i class="fas fa-pen-to-square"></i></div>
                    <h2>No Note Selected</h2>
                    <p>Select a note from the sidebar or create a new one.</p>
                </div>
                <div class="editor-container">
                    <input type="text" class="note-title" placeholder="Title">
                    <textarea class="note-content" placeholder="Start writing..."></textarea>
                </div>
            </div>
        </div>
        <div class="toolbar">
            <div class="info-text">
                <div class="statistics">
                    <div class="statistic word-count"><i class="fas fa-font"></i> 0 words</div>
                    <div class="statistic reading-time"><i class="fas fa-clock"></i> 0 min read</div>
                </div>
            </div>
            <div class="actions">
                <button class="action-btn theme-switch" title="Toggle Theme"><i class="fas fa-moon"></i></button>
                <button class="action-btn export-note-btn" title="Export Note"><i class="fas fa-file-export"></i></button>
                <button class="action-btn delete-note-btn" title="Delete Note"><i class="fas fa-trash"></i></button>
            </div>
        </div>
    </div>

    <div class="notification">
        <i class="fas fa-check-circle"></i>
        <span class="notification-message"></span>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script>
        const notesList = document.querySelector('.notes-list');
        const newNoteBtn = document.querySelector('.new-note-btn');
        const noteTitle = document.querySelector('.note-title');
        const noteContent = document.querySelector('.note-content');
        const editorPlaceholder = document.querySelector('.editor-placeholder');
        const editorContainer = document.querySelector('.editor-container');
        const sidebarToggle = document.querySelector('.sidebar-toggle');
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.overlay');
        const notesCount = document.querySelector('.notes-count');
        const deleteNoteBtn = document.querySelector('.delete-note-btn');
        const themeSwitch = document.querySelector('.theme-switch');
        const searchInput = document.querySelector('.search-input');
        const wordCount = document.querySelector('.word-count');
        const readingTime = document.querySelector('.reading-time');
        const exportAllBtn = document.querySelector('.export-all-btn');
        const importBtn = document.querySelector('.import-btn');
        const importFileInput = document.querySelector('.import-file-input');
        const notification = document.querySelector('.notification');
        const notificationMessage = document.querySelector('.notification-message');
        const exportNoteBtn = document.querySelector('.export-note-btn');
        const searchHelpBtn = document.querySelector('.search-help-btn');
        const searchHelpTooltip = document.querySelector('.search-help-tooltip');

        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let activeNote = null;
        let darkMode = localStorage.getItem('darkMode') !== 'false';
        let searchTimeout = null;

        // Show notification
        function showNotification(message, isError = false) {
            notification.classList.remove('error');
            if (isError) {
                notification.classList.add('error');
            }
            notificationMessage.textContent = message;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Load notes from local storage
        function loadNotes() {
            notesList.innerHTML = '';
            notes.forEach((note, index) => {
                const noteItem = document.createElement('li');
                noteItem.classList.add('note-item');
                noteItem.setAttribute('data-index', index);
                noteItem.innerHTML = `
                    <div class="note-item-title">${note.title || 'Untitled'}</div>
                    <div class="note-item-preview">${note.content.substring(0, 50)}</div>
                    <div class="note-item-footer">
                        <span class="timestamp">${new Date(note.timestamp).toLocaleString()}</span>
                    </div>
                `;
                noteItem.addEventListener('click', () => loadNote(index));
                notesList.appendChild(noteItem);
            });
            notesCount.textContent = `${notes.length} note${notes.length !== 1 ? 's' : ''}`;
        }

        // Load a specific note
        function loadNote(index) {
            activeNote = index;
            const note = notes[index];

            noteTitle.value = note.title;
            noteContent.value = note.content;
            editorPlaceholder.style.display = 'none';
            editorContainer.style.display = 'flex';
            updateWordCount();
            updateReadingTime();

            // If sidebar is open on mobile, close it
            if (window.innerWidth <= 768 && sidebar.classList.contains('active')) {
                toggleSidebar();
            }
        }

        // Create a new note
        function createNote() {
            const timestamp = new Date().toISOString();
            const newNote = {
                title: '',
                content: '',
                timestamp
            };
            notes.push(newNote);
            saveNotes();
            loadNotes();
            resetEditor();
            loadNote(notes.length - 1);
        }

        // Save notes to local storage
        function saveNotes() {
            localStorage.setItem('notes', JSON.stringify(notes));
        }

        // Update the current note
        function updateNote() {
            if (activeNote !== null) {
                notes[activeNote].title = noteTitle.value;
                notes[activeNote].content = noteContent.value;
                notes[activeNote].timestamp = new Date().toISOString();
                saveNotes();
                loadNotes();
            }
        }

        // Delete the current note
        function deleteNote() {
            if (activeNote !== null) {
                const confirmDelete = confirm("Are you sure you want to delete this note?");
                if (confirmDelete) {
                    notes.splice(activeNote, 1);
                    saveNotes();
                    loadNotes();
                    resetEditor();
                }
            }
        }

        // Reset the editor
        function resetEditor() {
            noteTitle.value = '';
            noteContent.value = '';
            editorPlaceholder.style.display = 'flex';
            editorContainer.style.display = 'none';
            activeNote = null;
            updateWordCount();
            updateReadingTime();
        }

        // Update word count
        function updateWordCount() {
            const content = noteContent.value;
            const words = content ? content.trim().split(/\s+/).filter(word => word.length > 0) : [];
            wordCount.textContent = `${words.length} words`;
        }

        // Update reading time
        function updateReadingTime() {
            const content = noteContent.value;
            const words = content ? content.trim().split(/\s+/).filter(word => word.length > 0) : [];
            const minutes = Math.ceil(words.length / 200);
            readingTime.textContent = `${minutes} min read`;
        }

        // Toggle dark mode
        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', darkMode);
            document.body.classList.toggle('light-mode', !darkMode);
        }

        // Toggle sidebar
        function toggleSidebar() {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        // Export all notes as a JSON file
        exportAllBtn.addEventListener('click', () => {
            const blob = new Blob([JSON.stringify(notes, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'notes.json';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            showNotification('All notes exported successfully!');
        });

        // Export the current note as a text file
        exportNoteBtn.addEventListener('click', () => {
            if (activeNote !== null) {
                const note = notes[activeNote];
                const blob = new Blob([note.content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `${note.title || 'Untitled'}.txt`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                showNotification('Note exported successfully!');
            }
        });

        // Import notes from a JSON file
        importBtn.addEventListener('click', () => {
            importFileInput.click();
        });

        importFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedNotes = JSON.parse(e.target.result);
                        if (Array.isArray(importedNotes)) {
                            notes = importedNotes;
                            saveNotes();
                            loadNotes();
                            resetEditor();
                            showNotification('Notes imported successfully!');
                        } else {
                            showNotification('Invalid file format.', true);
                        }
                    } catch (error) {
                        showNotification('Failed to import notes.', true);
                    }
                };
                reader.readAsText(file);
            }
        });

        // Render notes based on search input
        function renderNotes(filteredNotes) {
            notesList.innerHTML = '';
            const query = searchInput.value.toLowerCase().trim();
            const searchTerms = query ? query.split(/\s+/) : [];

            filteredNotes.forEach((note, i) => {
                // Find the actual index in the original notes array
                const originalIndex = notes.findIndex(n => n === note);

                let title = note.title || 'Untitled';
                let content = note.content.substring(0, 50);

                // Highlight matching terms in title and preview
                if (searchTerms.length > 0) {
                    searchTerms.forEach(term => {
                        if (!term) return;

                        const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                        title = title.replace(regex, '<span class="highlight-match">$1</span>');
                        content = content.replace(regex, '<span class="highlight-match">$1</span>');
                    });
                }

                const noteItem = document.createElement('li');
                noteItem.classList.add('note-item');
                noteItem.setAttribute('data-index', originalIndex);
                noteItem.innerHTML = `
                    <div class="note-item-title">${title}</div>
                    <div class="note-item-preview">${content}</div>
                    <div class="note-item-footer">
                        <span class="timestamp">${new Date(note.timestamp).toLocaleString()}</span>
                    </div>
                `;
                noteItem.addEventListener('click', () => loadNote(originalIndex));
                notesList.appendChild(noteItem);
            });
        }

        // Event listeners
        newNoteBtn.addEventListener('click', createNote);
        noteTitle.addEventListener('input', updateNote);
        noteContent.addEventListener('input', () => {
            updateNote();
            updateWordCount();
            updateReadingTime();
        });
        deleteNoteBtn.addEventListener('click', deleteNote);
        themeSwitch.addEventListener('click', toggleDarkMode);
        sidebarToggle.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', toggleSidebar);
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const query = searchInput.value.trim();

                if (!query) {
                    renderNotes(notes);
                    notesCount.textContent = `${notes.length} note${notes.length !== 1 ? 's' : ''}`;
                    return;
                }

                // Parse the search query into tokens
                const tokens = parseSearchQuery(query);

                // Filter notes based on the tokens
                const searchResults = performTokenSearch(notes, tokens);

                // Render the filtered notes
                renderNotes(searchResults.map(result => result.note));

                // Update the notes count with search results
                notesCount.textContent = `${searchResults.length} of ${notes.length} notes`;
            }, 300);
        });

        // Initialize the search help tooltip
        searchInput.setAttribute('placeholder', 'Search notes... (try "quotes" or +required)');

        // Optional: Add click functionality instead of hover
        searchHelpBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            searchHelpTooltip.classList.toggle('active');
        });

        // Close tooltip when clicking elsewhere
        document.addEventListener('click', () => {
            searchHelpTooltip.classList.remove('active');
        });

        /**
         * Parse a search query into tokens with operators
         * Supports:
         * - Quoted phrases: "exact match"
         * - Regular terms
         */
        function parseSearchQuery(query) {
            const tokens = [];
            let current = '';
            let inQuotes = false;

            // Helper to add current token to the tokens array
            const addToken = (str, type = 'normal') => {
                if (str) tokens.push({ text: str.toLowerCase(), type });
            };

            // Parse the query character by character
            for (let i = 0; i < query.length; i++) {
                const char = query[i];

                if (char === '"') {
                    if (inQuotes) {
                        // End of a quoted phrase
                        addToken(current, 'phrase');
                        current = '';
                        inQuotes = false;
                    } else {
                        // Start of a quoted phrase
                        if (current) addToken(current);
                        current = '';
                        inQuotes = true;
                    }
                } else if (!inQuotes && (char === ' ' || char === '\t')) {
                    // Space outside quotes means end of current token
                    addToken(current);
                    current = '';
                } else {
                    // Add character to current token
                    current += char;
                }
            }

            // Add the last token if there is one
            if (current) {
                if (inQuotes) {
                    addToken(current, 'phrase');
                } else {
                    addToken(current);
                }
            }

            // Process operators
            return tokens.map(token => {
                if (token.text.startsWith('+')) {
                    return { text: token.text.substring(1), type: 'required' };
                } else if (token.text.startsWith('-')) {
                    return { text: token.text.substring(1), type: 'excluded' };
                }
                return token;
            }).filter(token => token.text); // Remove empty tokens
        }

        /**
         * Perform token-based search on notes
         */
        function performTokenSearch(notes, tokens) {
            if (!tokens.length) return [];

            return notes
                .map(note => {
                    const titleText = note.title.toLowerCase();
                    const contentText = note.content.toLowerCase();
                    let score = 0;
                    let isMatch = true;

                    // Check each token against the note
                    tokens.forEach(token => {
                        let tokenMatch = false;

                        if (token.type === 'phrase') {
                            // Exact phrase matching
                            if (titleText.includes(token.text)) {
                                score += 15;
                                tokenMatch = true;
                            }
                            if (contentText.includes(token.text)) {
                                score += 10;
                                tokenMatch = true;
                            }
                        } else {
                            // Word boundary check for more precise matching
                            const titleMatches = findWordMatches(titleText, token.text);
                            const contentMatches = findWordMatches(contentText, token.text);

                            if (titleMatches.length > 0) {
                                // Title matches are weighted higher
                                score += titleMatches.reduce((sum, match) => sum + calculateMatchScore(match, true), 0);
                                tokenMatch = true;
                            }

                            if (contentMatches.length > 0) {
                                score += contentMatches.reduce((sum, match) => sum + calculateMatchScore(match, false), 0);
                                tokenMatch = true;
                            }
                        }

                        // Handle required and excluded tokens
                        if (token.type === 'required' && !tokenMatch) {
                            isMatch = false;
                        } else if (token.type === 'excluded' && tokenMatch) {
                            isMatch = false;
                        }
                    });

                    return {
                        note,
                        score,
                        isMatch
                    };
                })
                .filter(result => result.isMatch)
                .sort((a, b) => b.score - a.score);
        }

        /**
         * Find all occurrences of a term in text with word boundary awareness
         */
        function findWordMatches(text, term) {
            const matches = [];
            const words = text.split(/\b/);
            let index = 0;

            for (let i = 0; i < words.length; i++) {
                const word = words[i].trim();
                if (!word) {
                    index += words[i].length;
                    continue;
                }

                if (word === term) {
                    // Exact match
                    matches.push({
                        word,
                        index,
                        type: 'exact'
                    });
                } else if (word.startsWith(term)) {
                    // Prefix match
                    matches.push({
                        word,
                        index,
                        type: 'prefix'
                    });
                } else if (word.includes(term)) {
                    // Substring match
                    matches.push({
                        word,
                        index,
                        type: 'substring'
                    });
                }

                index += words[i].length;
            }

            return matches;
        }

        /**
         * Calculate the score for a match based on match type and location
         */
        function calculateMatchScore(match, isTitle) {
            // Base scores
            const locationMultiplier = isTitle ? 2 : 1;

            // Score based on match type
            switch (match.type) {
                case 'exact':
                    return 10 * locationMultiplier;
                case 'prefix':
                    return 5 * locationMultiplier;
                case 'substring':
                    return 2 * locationMultiplier;
                default:
                    return 1 * locationMultiplier;
            }
        }

        /**
         * Highlight search matches in rendered notes
         * Update this function to highlight matches more precisely
         */
        function highlightMatches(text, tokens) {
            if (!tokens || !tokens.length) return text;

            let highlighted = text;

            // Sort tokens by length (descending) to prevent nested highlights
            const sortedTokens = [...tokens].sort((a, b) => b.text.length - a.text.length);

            sortedTokens.forEach(token => {
                // Skip excluded tokens for highlighting
                if (token.type === 'excluded') return;

                const regex = new RegExp(
                    token.type === 'phrase'
                        ? `(${escapeRegExp(token.text)})`
                        : `\\b(${escapeRegExp(token.text)})\\w*\\b`,
                    'gi'
                );

                highlighted = highlighted.replace(regex, '<span class="highlight-match">$1</span>');
            });

            return highlighted;
        }

        // Helper to escape special characters in regular expressions
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Update the renderNotes function to use the new highlighting
        function renderNotes(filteredNotes) {
            notesList.innerHTML = '';
            const query = searchInput.value.trim();
            const tokens = query ? parseSearchQuery(query) : [];

            filteredNotes.forEach((note, i) => {
                // Find the actual index in the original notes array
                const originalIndex = notes.findIndex(n => n === note);

                let title = note.title || 'Untitled';
                let content = note.content.substring(0, 50);

                // Highlight matching terms in title and preview
                if (tokens.length > 0) {
                    title = highlightMatches(title, tokens);
                    content = highlightMatches(content, tokens);
                }

                const noteItem = document.createElement('li');
                noteItem.classList.add('note-item');
                noteItem.setAttribute('data-index', originalIndex);
                noteItem.innerHTML = `
                    <div class="note-item-title">${title}</div>
                    <div class="note-item-preview">${content}</div>
                    <div class="note-item-footer">
                        <span class="timestamp">${new Date(note.timestamp).toLocaleString()}</span>
                    </div>
                `;
                noteItem.addEventListener('click', () => loadNote(originalIndex));
                notesList.appendChild(noteItem);
            });
        }

        // Initial load
        loadNotes();
        if (!darkMode) {
            document.body.classList.add('light-mode');
        }

        // Syntax highlighting
        Prism.highlightAll();

        // Add auto-save functionality
        let autoSaveTimer;
        noteContent.addEventListener('input', () => {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                if (activeNote !== null) {
                    const saveIndicator = document.createElement('div');
                    saveIndicator.className = 'save-indicator';
                    saveIndicator.textContent = 'Saved';
                    saveIndicator.style.position = 'fixed';
                    saveIndicator.style.bottom = '20px';
                    saveIndicator.style.right = '20px';
                    saveIndicator.style.background = 'var(--accent-color)';
                    saveIndicator.style.color = 'white';
                    saveIndicator.style.padding = '12px 20px';
                    saveIndicator.style.borderRadius = '10px';
                    saveIndicator.style.boxShadow = '0 4px 20px rgba(0,0,0,0.2)';
                    saveIndicator.style.opacity = '0';
                    saveIndicator.style.transition = 'opacity 0.3s, transform 0.3s';
                    saveIndicator.style.transform = 'translateY(20px)';

                    document.body.appendChild(saveIndicator);
                    setTimeout(() => {
                        saveIndicator.style.opacity = '1';
                        saveIndicator.style.transform = 'translateY(0)';
                    }, 10);

                    setTimeout(() => {
                        saveIndicator.style.opacity = '0';
                        saveIndicator.style.transform = 'translateY(20px)';
                        setTimeout(() => {
                            document.body.removeChild(saveIndicator);
                        }, 300);
                    }, 2000);
                }
            }, 1000);
        });
    </script>
</body>
</html>
